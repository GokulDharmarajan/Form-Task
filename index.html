<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bootstrap demo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<link rel="stylesheet" href="./index.css">

<body>
  <div class="container">
    <div class="row mt-2">
      <div class="text-center mt-3 col-12 col-lg-5 col-md-5 col-xl-5 col-xxl-5 mx-auto">
        <div class="card mx-auto p-3">

          <i class="fa-regular fa-circle-user fa-3x mb-3"></i>
          <input type="text" placeholder="Name" id="cname" name="cname" class="form-control mt-2 mb-2" />
          <input type="email" placeholder="Email" id="email" name="email" class="form-control mt-2 mb-2" />
          <textarea class="form-control mt-2 mb-2" placeholder="comments" id="message" name="message"
            rows="6"></textarea>
          <div class="d-flex justify-content-center w-50 mx-auto">
            <button onclick="insert()" class="btn btn-primary mx-auto mt-2 mb-2 btn-lg button" id="add">
              Submit
            </button>
            <button onclick="updatedata()" type="button" class="btn btn-success mx-auto mt-2 mb-2 btn-lg  button"
              id="update">
              Update
            </button>
          </div>
        </div>
      </div>

    </div>
  </div>
  <div class="container">
    <div class="card mt-3 mb-3 table-responsive text-center p-3 ">
      <table class=" table table-bordered mb-0">
        <thead>
          <tr>
            <th scope="col">ID</th>
            <th scope="col">Name</th>
            <th scope="col">Email</th>
            <th scope="col">Message</th>
            <th scope="col">Tools</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>


  <script>
    var datapass = "";
    function insert() {
      console.log("insert button clicked");
      fetch("http://localhost:3000/insert", {
        method: "POST",
        body: JSON.stringify({
          cname: document.getElementById("cname").value,
          email: document.getElementById("email").value,
          message: document.getElementById("message").value,
        }),
        headers: {
          "Content-type": "application/json; charset=UTF-8",
        },
      })
        .then((response) => response.json())
        .then((json) => console.log(json));

    }
    // GET METHOD


    fetch("http://localhost:3000/")
      .then((res) => res.json())
      .then((user) => {
        html = "";
        user.forEach((e) => {
          html += `<tr>
                            <td>${e.id}</td>
                            <td>${e.cname}</td>
                            <td>${e.email}</td>
                            <td>${e.message}</td>
                            <td>
                               <button onclick="edit('${e.id}','${e.cname}','${e.email}','${e.message}')" class="btn btn-success mx-auto mt-2 mb-2 btn-sm" > <i class="fa-solid fa-pen-to-square "></i></button> 
                               <button onclick="deletedata('${e.id}')"class="btn btn-danger mx-auto mt-2 mb-2 btn-sm" > <i class="fa-solid fa-trash"></i></i></button> 
                             </td>
                              
                     </tr>`;
        });
        console.log(html);
        document.getElementsByTagName("tbody")[0].innerHTML = html;
      })
      .catch((err) => {
        console.log("DDD", err);
      });



    // update
    function updatedata() {
      console.log("insert button clicked");
      fetch("http://localhost:3000/update", {
        method: "put",
        body: JSON.stringify({
          id: datapass,
          cname: document.getElementById("cname").value,
          email: document.getElementById("email").value,
          message: document.getElementById("message").value,

        }),
        headers: {
          "Content-type": "application/json; charset=UTF-8",
        },

      })
        .then((response) => response.json())
        .then((json) => console.log(json));
    }

    // Edit
    function edit(id, cname, email, message) {
      datapass = id;
      document.getElementById("cname").value = cname;
      document.getElementById("email").value = email;
      document.getElementById("message").value = message;
      document.getElementById("add").style = "display:none";
      document.getElementById("update").style = "display:block";
    }

    // Delete

    function deletedata(id, is_active) {
      fetch("http://localhost:3000/delete", {

        method: "put",
        body: JSON.stringify({
          id: id,
          is_active: 0,
        }),
        headers: {
          "Content-type": "application/json; charset=UTF-8",
        },
      })
        .then((response) => response.json())
        .then((json) => console.log(json));

    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"
    integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js"
    integrity="sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ"
    crossorigin="anonymous"></script>
</body>

</html>